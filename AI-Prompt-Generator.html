<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom AI Prompt Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    /* Styling global untuk body */
    body {
      font-family: 'Arial', sans-serif;
      margin: 20px;
      background-color: #f9f9f9;
      color: #333;
      line-height: 1.6;
    }

    /* Heading */
    h1 {
      text-align: center;
      color: #4CAF50;
      font-size: 2.5rem;
      margin-bottom: 20px;
    }

    /* Container untuk form */
    form {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Styling label */
    label {
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
      color: #555;
    }

    /* Styling input file khusus */
    input[type="file"] {
      display: block;
      margin: 0 auto;
      font-size: 1.6rem;
      text-align: center;
      padding: 10px;
      max-width: 100%;
      width: auto; /* Pastikan lebar menyesuaikan konten */
      white-space: nowrap; /* Tampilkan teks dalam satu baris */
      overflow: visible; /* Hindari teks terpotong */
      text-overflow: clip; /* Jangan potong teks dengan ellipsis */
    }

    /* Styling input dan select lainnya */
    select {
      width: 100%;
      max-width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
      margin-bottom: 15px;
      appearance: none; /* Menghapus style default browser */
      background: #fff url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%204%205%22%3E%3Cpath%20fill%3D%22%234CAF50%22%20d%3D%22M2%205l2-2H0z%22/%3E%3C/svg%3E') no-repeat right 10px center;
      background-size: 10px 10px;
    }

    /* Styling tombol */
    button {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #45a049;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    /* Responsive styling */
    @media (max-width: 768px) {
      form {
        padding: 15px;
      }

      h1 {
        font-size: 2rem;
      }

      input[type="file"],
      select,
      button {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <h1>Custom AI Prompt Generator</h1>
  <input type="file" id="fileInput" accept=".xlsx, .xls">
  <div id="controls" style="display: none;">
    <label for="character">Select Character:</label>
    <select id="character" onchange="autoFillPromptCharacter()"></select>
    <br>

    <label for="promptCharacter">Prompt Character:</label>
    <select id="promptCharacter"></select>
    <br>

    <label for="outfit">Select Outfit:</label>
    <select id="outfit" onchange="updateOutfitPrompt()"></select>
    <div class="preview" id="outfitPromptPreview"></div>
    <br>

    <label for="pose">Select Pose:</label>
    <select id="pose"></select>
    <br>

    <label for="background">Select Background:</label>
    <select id="background"></select>
    <br>

    <button onclick="generatePrompt()">Generate Prompt</button>
  </div>

  <div id="output"></div>

  <script>
    let database = [];

    // Load Excel file
    document.getElementById('fileInput').addEventListener('change', (event) => {
      const file = event.target.files[0];
      const reader = new FileReader();

      reader.onload = (e) => {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];
        database = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        populateControls();
      };

      reader.readAsArrayBuffer(file);
    });

    function populateControls() {
      const controls = document.getElementById('controls');
      const characterSelect = document.getElementById('character');
      const promptCharacterSelect = document.getElementById('promptCharacter');
      const outfitSelect = document.getElementById('outfit');
      const poseSelect = document.getElementById('pose');
      const backgroundSelect = document.getElementById('background');

      characterSelect.innerHTML = '<option value="">(None)</option>';
      promptCharacterSelect.innerHTML = '<option value="">(None)</option>';
      outfitSelect.innerHTML = '<option value="">(None)</option>';
      poseSelect.innerHTML = '<option value="">(None)</option>';
      backgroundSelect.innerHTML = '<option value="">(None)</option>';

      for (let i = 1; i < database.length; i++) {
        const row = database[i];
        if (!row) continue;

        const name = row[1] || '';
        const promptCharacter = row[3] || '';
        const outfit = row[2] || '';
        const promptOutfit = row[4] || '';
        const pose = row[5] || '';
        const background = row[6] || '';

        if (name) {
          const option = document.createElement('option');
          option.value = name;
          option.textContent = name;
          characterSelect.appendChild(option);
        }

        if (promptCharacter) {
          const option = document.createElement('option');
          option.value = promptCharacter;
          option.textContent = promptCharacter;
          promptCharacterSelect.appendChild(option);
        }

        if (outfit) {
          const option = document.createElement('option');
          option.value = i;
          option.textContent = outfit;
          outfitSelect.appendChild(option);
        }

        if (pose) {
          const option = document.createElement('option');
          option.value = pose;
          option.textContent = pose;
          poseSelect.appendChild(option);
        }

        if (background) {
          const option = document.createElement('option');
          option.value = background;
          option.textContent = background;
          backgroundSelect.appendChild(option);
        }
      }

      controls.style.display = 'block';
    }

    function autoFillPromptCharacter() {
      const character = document.getElementById('character').value;
      const promptCharacterSelect = document.getElementById('promptCharacter');

      promptCharacterSelect.value = '';

      if (character) {
        for (let i = 1; i < database.length; i++) {
          const row = database[i];
          if (row[1] === character && row[3]) {
            promptCharacterSelect.value = row[3];
            break;
          }
        }
      }
    }

    function updateOutfitPrompt() {
      const outfitIndex = document.getElementById('outfit').value;
      const preview = document.getElementById('outfitPromptPreview');

      if (outfitIndex) {
        const row = database[outfitIndex];
        preview.textContent = `Prompt Outfit: ${row[4] || '(No data available)'}`;
      } else {
        preview.textContent = '';
      }
    }

    function generatePrompt() {
      const character = document.getElementById('character').value;
      const promptCharacter = document.getElementById('promptCharacter').value;
      const outfitIndex = document.getElementById('outfit').value;
      const pose = document.getElementById('pose').value;
      const background = document.getElementById('background').value;

      let promptOutfit = '';
      let outfitName = '';
      if (outfitIndex) {
        const row = database[outfitIndex];
        outfitName = row[2] || '';
        promptOutfit = row[4] || '';
      }

      const combinedPrompt = [
        character.toLowerCase(),
        promptCharacter,
        promptOutfit,
        pose,
        background,
      ]
        .filter(part => part)
        .join(', ')
        .replace(/,\s*,/g, ',')
        .replace(/,\s*$/, '');

      const output = document.getElementById('output');
      output.innerHTML = `
        <h2>Generated Prompt</h2>
        ${character ? `<p><span class="bold">Character:</span> ${character}</p>` : ''}
        ${outfitName ? `<p><span class="bold">Outfit:</span> ${outfitName}</p>` : ''}
        <p><span class="bold">Prompt Result:</span> ${combinedPrompt || '(No prompt generated)'}</p>
        <button id="copyBtn">Copy to Clipboard</button>
      `;

      const copyBtn = document.getElementById('copyBtn');
      copyBtn.addEventListener('click', () => {
        const textToCopy = combinedPrompt || 'No prompt generated';
        const textArea = document.createElement('textarea');
        textArea.value = textToCopy;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);

        alert('Prompt copied to clipboard!');
      });
    }
  </script>
</body>
</html>
